{% extends "layout.html" %}

{% block body %}



<ul class="nav nav-pills">
  <li class="active"><a data-toggle="pill" href="#userinfo">Profile</a></li>
  {% if pd.authuser is defined and pd.authuser.uid == pd.profileuser.uid %}
  <li><a data-toggle="pill" href="#trades">Trades</a></li>
  {% endif %}
  <li><a data-toggle="pill" href="#messages">Messages</a></li>
  <li><a data-toggle="pill" href="#collections">Collections</a></li>
</ul>


<div class="tab-content">
  <div id="userinfo" class="tab-pane fade in active">
    {% if pd.authuser is undefined or pd.authuser.uid != pd.profileuser.uid %}
        <div class="page-header"><h4>{{ pd.profileuser.username }}'s Profile</h4></div>
        <ul>
            <li>Member since: {{ pd.profileuser.joined }}</li>
            <li>Last seen: {{ pd.profileuser.lastseen }}</li>
        </ul>
    {% else %}
        <div class="page-header"><h4>Your Profile</h4></div>
        <ul>
            <li>Email: {{ pd.profileuser.email }}</li>
            <li>Member since: {{ pd.profileuser.joined }}</li>
            <li>Items added: {{ pd.profileuser.numadds }}</li>
            <li>Access level: {{ pd.accesslevels[pd.profileuser.accesslevel] }}</li>
        </ul>

        <div>
        <div class="page-header"><h4>Reset Password</h4></div>
        <form role="form" action="/pwreset" method="post">
          <div class="form-group">
            <label class="newuser-label" for="password">Current Password:</label>
            <input type=password name=password required><br />
          </div>

          <div class="form-group">
            <label class="newuser-label" for="newpassword">New Password:</label>
            <input type=password name=newpassword required><br />
          </div>

          <div class="form-group">
            <label class="newuser-label" for="newpassword2">Confirm password:</label>
            <input type=password name=newpassword2 required><br />
          </div>

          <div class="form-group">
            <input class="button" type=submit value=Submit>
          </div>
        </form>
        </div>

        <div>
        <div class="page-header"><h4>New Email</h4></div>
        <form role="form" action="/emailupdate" method="post">
          <div class="form-group">
            <label class="newuser-label" for="password">Password:</label>
            <input type=password name=password required><br />
          </div>

          <div class="form-group">
            <label class="newuser-label" for="email">New email address:</label>
            <input type=text name=email required><br />
          </div>

          <div class="form-group">
            <input class="button" type=submit value=Submit>
          </div>
        </form>
        </div>
    {% endif %}
  </div>

  {% if pd.authuser is defined and pd.authuser.uid == pd.profileuser.uid %}
  <div id="trades" class="tab-pane fade">
        <div class="page-header"><h4>Trade Requests</h4></div>

        <table class="table table-condensed">
        <tr>
        <th>Trade status</th>
        <th>Subject</th>
        <th>From</th>
        <th>To</th>
        <th>Date</th>
        <th></th>
        </tr>

        {% for pm in pd.profileuser.messages() %}
        {% if pm.status <= pm.messagestatus['cancelled_trade'] %}
            <tr>

            <td>
            {% if pm.status == pm.messagestatus['unread_trade'] and pm.from_user != pd.authuser.username %}
            <b>New</b>
            {% elif pm.status == pm.messagestatus['settled_trade'] %}
            Closed
            {% elif pm.status == pm.messagestatus['rejected_trade'] %}
            Rejected
            {% elif pm.status == pm.messagestatus['cancelled_trade'] %}
            Cancelled
            {% else %}
            Open
            {% endif %}
            </td>

            <td>{{ pm.subject }}</td>

            <td>
            <a href="/user/{{ pm.from_user }}">{{ pm.from_user }}</a>
            </td>

            <td>
            <a href="/user/{{ pm.to_user }}">{{ pm.to_user }}</a><br />
            </td>

            <td>{{ pm.sent }}</td>

            <td>
            <a href="/user/{{ pd.authuser.username }}/pm/{{ pm.uid_obfuscated }}">View</a></br>
            </td>

            </tr>
        {% endif %}
        {% endfor %}
        </table>

        <div class="page-header"><h4>Offline Trades</h4></div>

        <table class="table table-condensed">
        <tr>
        <th>Trade status</th>
        <th>Item</th>
        <th>Notes</th>
        <th>Date</th>
        </tr>

        <tr>
            <td>Closed <a href=""><span class="glyphicon glyphicon-repeat" aria-hidden="true" style="color: green;"></span></a></td>
            <td><a href="">[======  image  ======] Some item</a></td>
            <td>Trading for Some Awesome Item from Some Dude</td>
            <td>4/20</td>
        </tr>
        <tr>
            <td>Cancelled <a href=""><span class="glyphicon glyphicon-repeat" aria-hidden="true" style="color: green;"></span></a></td>
            <td><a href="">[======  image  ======] A different item</a></td>
            <td>Trading for Random Item from Some Shady Dude</td>
            <td>4/27</td>
        </tr>

        <tr>
            <td>Open <a href=""><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><a href=""><span class="glyphicon glyphicon-remove" aria-hidden="true" style="color: red;"></span></td>
            <td><a href="">[======  image  ======] Some other item</a></td>
            <td>Trading for Some Other Awesome Item from Some Dude. <a href=""><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></td>
            <td>6/30 <a href=""><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span></a></td>
        </tr>
        <tr>
            <td>Open <a href=""><span class="glyphicon glyphicon-ok" aria-hidden="true"></span><a href=""><span class="glyphicon glyphicon-remove" aria-hidden="true" style="color: red;"></span></td>
            <td><a href="">[======  image  ======] Excellent item</a></td>
            <td>Trading for Some Other Nifty Item from Some Other Dude. <a href=""><span class="glyphicon glyphicon-pencil" aria-hidden="true"></span></a></td>
            <td>7/15 <a href=""><span class="glyphicon glyphicon-calendar" aria-hidden="true"></span></a></td>
        </tr>
        <tr>
            <td><a href=""><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add</a></td></tr>
        </table>

  </div>
  {% endif %}



  <div id="messages" class="tab-pane fade">
    {% if pd.authuser is undefined or pd.authuser.uid != pd.profileuser.uid %}
        <div class="page-header"><h4>Send a message to {{ pd.profileuser.username }}</h4></div>
        <div class="container">
            <form action="/user/{{ pd.profileuser.username }}/pm" method="post" enctype="multipart/form-data">
                Subject: <input type=text name=subject default="Subject" required></br>
                Message: </br>
                <textarea name=body rows="4" cols="50"></textarea><br />
                <input type=submit value=Submit>
            </form>
        </div>
    {% else %}
        <div class="page-header"><h4>Received:</h4></div>

        <table class="table table-condensed">
        <tr>
            <th>From</th>
            <th>Date</th>
            <th>Subject</th>
        </tr>

        {% for pm in pd.profileuser.messages() %}
        {% if pm.from_user != pd.authuser.username and pm.status >= pm.messagestatus['unread_pm'] %}
        <tr>

            <td>
            <a href="/user/{{ pm.from_user }}">{{ pm.from_user }}</a>
            </td>

            <td>{{ pm.sent }}</td>

            <td>
            <a href="/user/{{ pd.authuser.username }}/pm/{{ pm.uid_obfuscated }}">
            {% if pm.status == pm.messagestatus['unread_pm'] %}
            <b>{{ pm.subject }}</b>
            {% else %}
            {{ pm.subject }}
            {% endif %}
            </a>
            </td>
        </tr>
        {% endif %}
        {% endfor %}

        </table>

        <div class="page-header"><h4>Sent:</h4></div>

        <table class="table table-condensed">
        <tr>
            <th>To</th>
            <th>Date</th>
            <th>Subject</th>
        </tr>

        {% for pm in pd.profileuser.messages() %}
        {% if pm.from_uid == pd.authuser.uid and pm.status >= pm.messagestatus['unread_pm'] %}
            <tr>

            <td>
            <a href="/user/{{ pm.to_user }}">{{ pm.to_user }}</a><br />
            </td>

            <td>{{ pm.sent }}</td>

            <td>
            <a href="/user/{{ pd.authuser.username }}/pm/{{ pm.uid_obfuscated }}">{{ pm.subject }}</a>
            </td>

            <td>
            </td>

            </tr>
        {% endif %}
        {% endfor %}

        </table>

    {% endif %}
  </div>
  <div id="collections" class="tab-pane fade">

    <div class="page-header"><h3>{{ pd.profileuser.username }}'s collection</h3></div>


    <table class="table">
    {% for item in pd.profileuser.collection() %}
    <tr>
      {% if pd.authuser is defined and pd.authuser.uid == pd.profileuser.uid %}
        {% if item.have == 1 %}
           <td>
               {% for image in item.images()[:1] %}
                   <a href="/item/{{ item.uid }}"><img style="max-height:100px; max-width:500px;" class="img-rounded" src="{{pd.prefix}}/resize/500x200/{{ image.uid }}" alt="{{ image.tag }}"><br /> </a>
               {% endfor %}
           </td>


            <td><a href="/item/{{ item.uid }}">{{ item.name }}</a></td>
            {% if item.hidden == 0 %}
                <td><a href="/item/{{ item.uid }}/hide">Don't show to others</a></td>
            {% else %}
                <td><a href="/item/{{ item.uid }}/show">Show to others</a></td>
            {% endif %}

            {% if item.willtrade == 1 %}
               <td><a href="/item/{{ item.uid }}/wonttrade">Mark as unavailable for trade</a></td>
            {% else %}
               <td><a href="/item/{{ item.uid }}/willtrade">Mark as available for trade</a></td>
            {% endif %}
           <td><a href="/item/{{ item.uid }}/donthave">Remove from collection</a></td>
        {% endif %}
      {% else %}
        {% if item.hidden == 0 and item.have == 1 %}
           <td>
               {% for image in item.images()[:1] %}
                   <a href="/item/{{ item.uid }}"><img style="max-height:100px; max-width:500px;" class="img-rounded" src="{{pd.prefix}}/resize/500x200/{{ image.uid }}" alt="{{ image.tag }}"><br /> </a>
               {% endfor %}
           </td>

            <td> <a href="/item/{{ item.uid }}">{{ item.name }}</a> </td>
            {% if item.willtrade == 1 %}
                <td>available for trade / <a href="/user/{{ pd.profileuser.username }}/trade/{{ item.uid }}">Make trade request</a></td>
            {% endif %}
        {% endif %}
      {% endif %}
    </tr>
    {% endfor %}
    </table>

    <div class="page-header"><h3>{{ pd.profileuser.username }}'s wanted list</h3></div>
    {% for item in pd.profileuser.collection() %}
     {% if item.want == 1 %}
     <div class="col-md-4">
       <div align="center">
           <a href="/item/{{ item.uid }}">{{ item.name }}</a><br \>

           {% for image in item.images()[:1] %}
           <p>
           <a href="/item/{{ item.uid }}"><img style="max-height:100px; max-width:500px;" class="img-rounded" src="{{pd.prefix}}/resize/500x200/{{ image.uid }}" alt="{{ image.tag }}"><br /> </a>
           </p>
           {% endfor %}

           {% if pd.authuser is defined and pd.authuser.uid == pd.profileuser.uid %}
             <small><a href="/item/{{ item.uid }}/dontwant"><span class="glyphicon glyphicon-trash"></span> Remove from list</a></small>
           {%else%}
             <a href="/user/{{ pd.profileuser.username }}/trade/{{ item.uid }}">Make trade request</a>
           {% endif %}
           </div>
       </div>
     {% endif %}
    {% endfor %}
</div>

{% endblock %}
