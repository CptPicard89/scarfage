{% extends "layout.html" %}

{% block body %}

{% include "login.html" %}

<div id="content">

<div id="message">
From: <a href="/user/{{ pd.pm.from_user }}">{{ pd.pm.from_user }}</a><br />
To: <a href="/user/{{ pd.pm.to_user}}">{{ pd.pm.to_user }}</a><br />
Message:
{{ pd.pm.message }}<br/>
</div>

{% for ti in pd.pm.items %}
<div id=tradeitem>
    {% if ti.user.uid == pd.authuser.uid %}
    ----]] your trade: {{ ti.item.name }}<br/>
    {% if ti.user.uid == pd.authuser.uid %}
    {% if ti.acceptstatus < pd.pm.tradestatus['accepted'] %}
        <a href="/user/{{ pd.authuser.username }}/pm/{{ pd.pm.uid }}/accept/{{ ti.uid }}">Accept item</a><br />

        {% if ti.acceptstatus == pd.pm.tradestatus['rejected'] %}
        Rejected<br />
        {% else %}
        <a href="/user/{{ pd.authuser.username }}/pm/{{ pd.pm.uid }}/reject/{{ ti.uid }}">Reject item</a> 
        {% endif %}
    {% else %}
        Accepted<br />
    {%endif%}
    {%endif%}
 
    {% else %}
    [[---- {{ti.user.username }}'s trade: {{ ti.item.name }} - <br />

    {% if ti.user.uid == pd.authuser.uid %}
    {% if ti.acceptstatus < pd.pm.tradestatus['accepted'] %}
        <a href="/user/{{ pd.authuser.username }}/pm/{{ pd.pm.uid }}/accept/{{ ti.uid }}">Accept item</a><br />

        {% if ti.acceptstatus == pd.pm.tradestatus['rejected'] %}
        Rejected<br />
        {% else %}
        <a href="/user/{{ pd.authuser.username }}/pm/{{ pd.pm.uid }}/reject/{{ ti.uid }}">Reject item</a> 
        {% endif %}
    {% else %}
        Accepted<br />
    {%endif%}
    {%endif%}
    {%endif%}
    {% if ti.item.images[0] is defined %}
        <img src="/image/{{ ti.item.images[0].filename }}/thumbnail" alt="{{ ti.item.images[0].tag }}"><br />
    {% endif %}
{% endfor %}

{% if pd.pm.status == pd.pm.messagestatus['complete_trade'] %}
All parties have accepted, please coordinate with {{ pd.pm.from_user }} to complete your trade!<br />
<a href="/user/{{ pd.authuser.username }}/pm/{{ pd.pm.uid }}/settle">Mark as settled!</a><br />
{% elif pd.pm.status == pd.pm.messagestatus['active_trade'] %}
<a href="/user/{{ pd.authuser.username }}/pm/{{ pd.pm.uid }}/reject">Reject trade</a><br />
{% elif pd.pm.status == pd.pm.messagestatus['rejected_trade'] %}
This trade has been closed as rejected!<br/>
{% elif pd.pm.status == pd.pm.messagestatus['settled_trade'] %}
Trade has been closed as settled!<br/>
{% endif %}
</div>
</div>

</div>
</div>

{% endblock %}
